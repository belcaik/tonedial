server {
  listen 80;
  server_name _;
  return 301 https://$host$request_uri;
}

server {
  listen 443 ssl;
  server_name activity.syncave.app;

  ssl_certificate /etc/nginx/certs/activity-syncave-app.crt;
  ssl_certificate_key /etc/nginx/certs/activity-syncave-app.key;
  ssl_session_cache shared:SSL:10m;
  ssl_protocols TLSv1.2 TLSv1.3;

  # CSP header to allow Discord iframe embedding
  add_header Content-Security-Policy "frame-ancestors 'self' https://discord.com https://*.discord.com;" always;

  # CORS headers for Discord Activity
  add_header Access-Control-Allow-Origin "*" always;
  add_header Access-Control-Allow-Methods "GET, POST, OPTIONS" always;
  add_header Access-Control-Allow-Headers "Content-Type, Authorization" always;

  root /usr/share/nginx/html;
  index index.html;

  # Custom error pages
  error_page 404 /404.html;
  error_page 500 502 503 504 /50x.html;

  location = /404.html {
    root /usr/share/nginx/html;
    internal;
  }

  location = /50x.html {
    root /usr/share/nginx/html;
    internal;
  }

  location / {
    try_files $uri /index.html;
  }
}
